<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Area of Applicability — aoa • CAST</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Area of Applicability — aoa"><meta name="description" content="This function estimates the Dissimilarity Index (DI) and the derived
Area of Applicability (AOA) of spatial prediction models by
considering the distance of new data (i.e. a SpatRaster of spatial predictors
used in the models) in the predictor variable space to the data used for model
training. Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training.
The AOA is derived by applying a threshold on the DI which is the (outlier-removed)
maximum DI of the cross-validated training data.
Optionally, the local point density is calculated which indicates the number of similar training data points up to the DI threshold."><meta property="og:description" content="This function estimates the Dissimilarity Index (DI) and the derived
Area of Applicability (AOA) of spatial prediction models by
considering the distance of new data (i.e. a SpatRaster of spatial predictors
used in the models) in the predictor variable space to the data used for model
training. Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training.
The AOA is derived by applying a threshold on the DI which is the (outlier-removed)
maximum DI of the cross-validated training data.
Optionally, the local point density is calculated which indicates the number of similar training data points up to the DI threshold."><meta property="og:image" content="https://hannameyer.github.io/CAST/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CAST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cast01-CAST-intro.html">1. Introduction to CAST</a></li>
    <li><a class="dropdown-item" href="../articles/cast02-plotgeodist.html">2. Visualization of nearest neighbor distance distributions</a></li>
    <li><a class="dropdown-item" href="../articles/cast03-CV.html">3. Nearest neighbor distance matching Cross-validation in CAST</a></li>
    <li><a class="dropdown-item" href="../articles/cast04-AOA-tutorial.html">4. Area of applicability of spatial prediction models</a></li>
    <li><a class="dropdown-item" href="../articles/cast05-parallel.html">5. Improve computation time of CAST methods</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/HannaMeyer/CAST/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Area of Applicability</h1>
      <small class="dont-index">Source: <a href="https://github.com/HannaMeyer/CAST/blob/master/R/aoa.R" class="external-link"><code>R/aoa.R</code></a></small>
      <div class="d-none name"><code>aoa.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function estimates the Dissimilarity Index (DI) and the derived
Area of Applicability (AOA) of spatial prediction models by
considering the distance of new data (i.e. a SpatRaster of spatial predictors
used in the models) in the predictor variable space to the data used for model
training. Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training.
The AOA is derived by applying a threshold on the DI which is the (outlier-removed)
maximum DI of the cross-validated training data.
Optionally, the local point density is calculated which indicates the number of similar training data points up to the DI threshold.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">aoa</span><span class="op">(</span></span>
<span>  <span class="va">newdata</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  trainDI <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  CVtest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  CVtrain <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"L2"</span>,</span>
<span>  useWeight <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useCV <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  LPD <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxLPD <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  indices <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"brute"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>A SpatRaster, stars object or data.frame containing the data
the model was meant to make predictions for.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A train object created with caret used to extract weights from (based on variable importance) as well as cross-validation folds.
See examples for the case that no model is available or for models trained via e.g. mlr3.</p></dd>


<dt id="arg-traindi">trainDI<a class="anchor" aria-label="anchor" href="#arg-traindi"></a></dt>
<dd><p>A trainDI object. Optional if <code><a href="trainDI.html">trainDI</a></code> was calculated beforehand.</p></dd>


<dt id="arg-train">train<a class="anchor" aria-label="anchor" href="#arg-train"></a></dt>
<dd><p>A data.frame containing the data used for model training. Optional. Only required when no model is given</p></dd>


<dt id="arg-weight">weight<a class="anchor" aria-label="anchor" href="#arg-weight"></a></dt>
<dd><p>A data.frame containing weights for each variable. Optional. Only required if no model is given.</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>character vector of predictor variables. if "all" then all variables
of the model are used or if no model is given then of the train dataset.</p></dd>


<dt id="arg-cvtest">CVtest<a class="anchor" aria-label="anchor" href="#arg-cvtest"></a></dt>
<dd><p>list or vector. Either a list where each element contains the data points used for testing during the cross validation iteration (i.e. held back data).
Or a vector that contains the ID of the fold for each training point.
Only required if no model is given.</p></dd>


<dt id="arg-cvtrain">CVtrain<a class="anchor" aria-label="anchor" href="#arg-cvtrain"></a></dt>
<dd><p>list. Each element contains the data points used for training during the cross validation iteration (i.e. held back data).
Only required if no model is given and only required if CVtrain is not the opposite of CVtest (i.e. if a data point is not used for testing, it is used for training).
Relevant if some data points are excluded, e.g. when using <code><a href="nndm.html">nndm</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. Method used for distance calculation. Currently euclidean distance (L2) and Mahalanobis distance (MD) are implemented but only L2 is tested. Note that MD takes considerably longer.</p></dd>


<dt id="arg-useweight">useWeight<a class="anchor" aria-label="anchor" href="#arg-useweight"></a></dt>
<dd><p>Logical. Only if a model is given. Weight variables according to importance in the model?</p></dd>


<dt id="arg-usecv">useCV<a class="anchor" aria-label="anchor" href="#arg-usecv"></a></dt>
<dd><p>Logical. Only if a model is given. Use the CV folds to calculate the DI threshold?</p></dd>


<dt id="arg-lpd">LPD<a class="anchor" aria-label="anchor" href="#arg-lpd"></a></dt>
<dd><p>Logical. Indicates whether the local point density should be calculated or not.</p></dd>


<dt id="arg-maxlpd">maxLPD<a class="anchor" aria-label="anchor" href="#arg-maxlpd"></a></dt>
<dd><p>numeric or integer. Only if <code>LPD = TRUE</code>. Number of nearest neighbors to be considered for the calculation of the LPD. Either define a number between 0 and 1 to use a percentage of the number of training samples for the LPD calculation or a whole number larger than 1 and smaller than the number of training samples. CAUTION! If not all training samples are considered, a fitted relationship between LPD and error metric will not make sense (@seealso <code><a href="errorProfiles.html">DItoErrormetric</a></code>)</p></dd>


<dt id="arg-indices">indices<a class="anchor" aria-label="anchor" href="#arg-indices"></a></dt>
<dd><p>logical. Calculate indices of the training data points that are responsible for the LPD of a new prediction location? Output is a matrix with the dimensions num(raster_cells) x maxLPD. Each row holds the indices of the training data points that are relevant for the specific LPD value at that location. Can be used in combination with exploreAOA(aoa) function from the <a href="https://github.com/fab-scm/CASTvis" class="external-link">CASTvis package</a> for a better visual interpretation of the results. Note that the matrix can be quite big for examples with a high resolution and a larger number of training samples, which can cause memory issues.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical. Parallelization the process. Only possible if LPD = TRUE. Can reduce computation time significantly.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Integer or Character. Number of cores to use for the the parallelization. You can use "auto" to set your cores to <code>detectCores()/2</code> (see <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></code>).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print progress or not?</p></dd>


<dt id="arg-algorithm">algorithm<a class="anchor" aria-label="anchor" href="#arg-algorithm"></a></dt>
<dd><p>see <code><a href="https://rdrr.io/pkg/FNN/man/knn.dist.html" class="external-link">knnx.dist</a></code> and <code><a href="https://rdrr.io/pkg/FNN/man/knn.index.html" class="external-link">knnx.index</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>aoa</code> containing:</p>
<dl><dt>parameters</dt>
<dd><p>object of class trainDI. see <code><a href="trainDI.html">trainDI</a></code></p></dd>

 <dt>DI</dt>
<dd><p>SpatRaster, stars object or data frame. Dissimilarity index of newdata</p></dd>

 <dt>LPD</dt>
<dd><p>SpatRaster, stars object or data frame. Local Point Density of newdata.</p></dd>

 <dt>AOA</dt>
<dd><p>SpatRaster, stars object or data frame. Area of Applicability of newdata. AOA has values 0 (outside AOA) and 1 (inside AOA)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Dissimilarity Index (DI), the Local Data Point Density (LPD) and the corresponding Area of Applicability (AOA) are calculated.
If variables are factors, dummy variables are created prior to weighting and distance calculation.</p>
<p>Interpretation of results: If a location is very similar to the properties
of the training data it will have a low distance in the predictor variable space
(DI towards 0) while locations that are very different in their properties
will have a high DI. For easier interpretation see <code><a href="normalize_DI.html">normalize_DI</a></code>
See Meyer and Pebesma (2021) for the full documentation of the methodology.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If classification models are used, currently the variable importance can only
be automatically retrieved if models were trained via train(predictors,response) and not via the formula-interface.
Will be fixed.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Meyer, H., Pebesma, E. (2021): Predicting into unknown space?
Estimating the area of applicability of spatial prediction models.
Methods in Ecology and Evolution 12: 1620-1633. <a href="https://doi.org/10.1111/2041-210X.13650" class="external-link">doi:10.1111/2041-210X.13650</a></p>
<p>Schumacher, F., Knoth, C., Ludwig, M., Meyer, H. (2025):
Estimation of local training data point densities to support the assessment
of spatial prediction uncertainty. Geosci. Model Dev., 18, 10185–10202. <a href="https://doi.org/10.5194/gmd-18-10185-2025" class="external-link">doi:10.5194/gmd-18-10185-2025</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="trainDI.html">trainDI</a></code>, <code><a href="normalize_DI.html">normalize_DI</a></code>, <code><a href="errorProfiles.html">errorProfiles</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Hanna Meyer, Fabian Schumacher</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># prepare sample data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cookfarm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">cookfarm</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VW"</span>,<span class="st">"Easting"</span>,<span class="st">"Northing"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>   by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cookfarm</span><span class="op">$</span><span class="va">SOURCEID</span><span class="op">)</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">dat</span>,coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Easting"</span>,<span class="st">"Northing"</span><span class="op">)</span>,crs<span class="op">=</span><span class="fl">26911</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pts</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="va">pts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">studyArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"predictors_2012-03-25.tif"</span>,package<span class="op">=</span><span class="st">"CAST"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">trainDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">studyArea</span>,<span class="va">pts</span>,na.rm<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trainDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">trainDat</span>,<span class="va">pts</span>,by.x<span class="op">=</span><span class="st">"ID"</span>,by.y<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># visualize data spatially:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">studyArea</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">studyArea</span><span class="op">$</span><span class="va">DEM</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">pts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,add<span class="op">=</span><span class="cn">TRUE</span>,col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># train a model:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEM"</span>,<span class="st">"NDRE.Sd"</span>,<span class="st">"TWI"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">)</span><span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span><span class="va">variables</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span><span class="va">trainDat</span><span class="op">$</span><span class="va">VW</span>, method<span class="op">=</span><span class="st">"rf"</span>, importance<span class="op">=</span><span class="cn">TRUE</span>, tuneLength<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>trControl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,number<span class="op">=</span><span class="fl">5</span>,savePredictions<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="co">#note that this is a quite poor prediction model</span></span></span>
<span class="r-in"><span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">studyArea</span>,<span class="va">model</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">model</span>,scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...then calculate the AOA of the trained model for the study area:</span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu">aoa</span><span class="op">(</span><span class="va">studyArea</span>, <span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">AOA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#... or if preferred calculate the aoa and the LPD of the study area:</span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu">aoa</span><span class="op">(</span><span class="va">studyArea</span>, <span class="va">model</span>, LPD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">LPD</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#note that it is not required to use Random Forests. The method is model agnostic.</span></span></span>
<span class="r-in"><span><span class="co"># Let's chnage to SVM:</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">)</span><span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span><span class="va">variables</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span><span class="va">trainDat</span><span class="op">$</span><span class="va">VW</span>, method<span class="op">=</span><span class="st">"svmRadial"</span>, importance<span class="op">=</span><span class="cn">TRUE</span>, tuneLength<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>trControl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,number<span class="op">=</span><span class="fl">5</span>,savePredictions<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu">aoa</span><span class="op">(</span><span class="va">studyArea</span>, <span class="va">model</span>, LPD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">LPD</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####</span></span></span>
<span class="r-in"><span><span class="co">#The AOA can also be calculated without a trained model.</span></span></span>
<span class="r-in"><span><span class="co">#All variables are weighted equally in this case:</span></span></span>
<span class="r-in"><span><span class="co">####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu">aoa</span><span class="op">(</span><span class="va">studyArea</span>,train<span class="op">=</span><span class="va">trainDat</span>,variables<span class="op">=</span><span class="va">variables</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####</span></span></span>
<span class="r-in"><span><span class="co"># The AOA can also be used for models trained via mlr3 (parameters have to be assigned manually):</span></span></span>
<span class="r-in"><span><span class="co">####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3spatial.mlr-org.com" class="external-link">mlr3spatial</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3spatiotempcv.mlr-org.com/" class="external-link">mlr3spatiotempcv</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mlr3extralearners</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># initiate and train model:</span></span></span>
<span class="r-in"><span><span class="va">train_df</span> <span class="op">&lt;-</span> <span class="va">trainDat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEM"</span>,<span class="st">"NDRE.Sd"</span>,<span class="st">"TWI"</span>, <span class="st">"VW"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">backend</span> <span class="op">&lt;-</span> <span class="fu">as_data_backend</span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu">as_task_regr</span><span class="op">(</span><span class="va">backend</span>, target <span class="op">=</span> <span class="st">"VW"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lrn</span> <span class="op">&lt;-</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"regr.randomForest"</span>, importance <span class="op">=</span> <span class="st">"mse"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lrn</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># cross-validation folds</span></span></span>
<span class="r-in"><span><span class="va">rsmp_cv</span> <span class="op">&lt;-</span> <span class="fu">rsmp</span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span><span class="op">$</span><span class="fu">instantiate</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## predict:</span></span></span>
<span class="r-in"><span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">studyArea</span>,<span class="va">lrn</span><span class="op">$</span><span class="va">model</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Estimate AOA</span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu">aoa</span><span class="op">(</span><span class="va">studyArea</span>,</span></span>
<span class="r-in"><span>           train <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           variables <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">feature_names</span>,</span></span>
<span class="r-in"><span>           weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lrn</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           CVtest <span class="op">=</span> <span class="va">rsmp_cv</span><span class="op">$</span><span class="va">instance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">row_id</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">fold</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanna Meyer, Carles Milà, Marvin Ludwig, Jan Linnenbrink, Fabian Schumacher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

