<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Dissimilarity Index of training data — trainDI • CAST</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Dissimilarity Index of training data — trainDI"><meta name="description" content="This function estimates the Dissimilarity Index (DI)
within the training data set used for a prediction model.
Optionally, the local point density can also be calculated.
Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training."><meta property="og:description" content="This function estimates the Dissimilarity Index (DI)
within the training data set used for a prediction model.
Optionally, the local point density can also be calculated.
Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training."><meta property="og:image" content="https://hannameyer.github.io/CAST/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CAST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cast01-CAST-intro.html">1. Introduction to CAST 1.0.0</a></li>
    <li><a class="dropdown-item" href="../articles/cast02-plotgeodist.html">2. Visualization of nearest neighbor distance distributions</a></li>
    <li><a class="dropdown-item" href="../articles/cast03-CV.html">3. Nearest neighbor distance matching Cross-validation in CAST</a></li>
    <li><a class="dropdown-item" href="../articles/cast04-AOA-tutorial.html">4. Area of applicability of spatial prediction models</a></li>
    <li><a class="dropdown-item" href="../articles/cast05-parallel.html">5. Improve computation time of CAST methods</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/HannaMeyer/CAST/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Dissimilarity Index of training data</h1>
      <small class="dont-index">Source: <a href="https://github.com/HannaMeyer/CAST/blob/master/R/trainDI.R" class="external-link"><code>R/trainDI.R</code></a></small>
      <div class="d-none name"><code>trainDI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function estimates the Dissimilarity Index (DI)
within the training data set used for a prediction model.
Optionally, the local point density can also be calculated.
Predictors can be weighted based on the internal
variable importance of the machine learning algorithm used for model training.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trainDI</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  CVtest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  CVtrain <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"L2"</span>,</span>
<span>  useWeight <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useCV <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  LPD <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A train object created with caret used to extract weights from (based on variable importance) as well as cross-validation folds</p></dd>


<dt id="arg-train">train<a class="anchor" aria-label="anchor" href="#arg-train"></a></dt>
<dd><p>A data.frame containing the data used for model training. Only required when no model is given</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>character vector of predictor variables. if "all" then all variables
of the model are used or if no model is given then of the train dataset.</p></dd>


<dt id="arg-weight">weight<a class="anchor" aria-label="anchor" href="#arg-weight"></a></dt>
<dd><p>A data.frame containing weights for each variable. Only required if no model is given.</p></dd>


<dt id="arg-cvtest">CVtest<a class="anchor" aria-label="anchor" href="#arg-cvtest"></a></dt>
<dd><p>list or vector. Either a list where each element contains the data points used for testing during the cross validation iteration (i.e. held back data).
Or a vector that contains the ID of the fold for each training point.
Only required if no model is given.</p></dd>


<dt id="arg-cvtrain">CVtrain<a class="anchor" aria-label="anchor" href="#arg-cvtrain"></a></dt>
<dd><p>list. Each element contains the data points used for training during the cross validation iteration (i.e. held back data).
Only required if no model is given and only required if CVtrain is not the opposite of CVtest (i.e. if a data point is not used for testing, it is used for training).
Relevant if some data points are excluded, e.g. when using <code><a href="nndm.html">nndm</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. Method used for distance calculation. Currently euclidean distance (L2) and Mahalanobis distance (MD) are implemented but only L2 is tested. Note that MD takes considerably longer.</p></dd>


<dt id="arg-useweight">useWeight<a class="anchor" aria-label="anchor" href="#arg-useweight"></a></dt>
<dd><p>Logical. Only if a model is given. Weight variables according to importance in the model?</p></dd>


<dt id="arg-usecv">useCV<a class="anchor" aria-label="anchor" href="#arg-usecv"></a></dt>
<dd><p>Logical. Only if a model is given. Use the CV folds to calculate the DI threshold?</p></dd>


<dt id="arg-lpd">LPD<a class="anchor" aria-label="anchor" href="#arg-lpd"></a></dt>
<dd><p>Logical. Indicates whether the local point density should be calculated or not.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print progress or not?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of class <code>trainDI</code> containing:</p>
<dl><dt>train</dt>
<dd><p>A data frame containing the training data</p></dd>

 <dt>weight</dt>
<dd><p>A data frame with weights based on the variable importance.</p></dd>

 <dt>variables</dt>
<dd><p>Names of the used variables</p></dd>

 <dt>catvars</dt>
<dd><p>Which variables are categorial</p></dd>

 <dt>scaleparam</dt>
<dd><p>Scaling parameters. Output from <code>scale</code></p></dd>

 <dt>trainDist_avrg</dt>
<dd><p>A data frame with the average distance of each training point to every other point</p></dd>

 <dt>trainDist_avrgmean</dt>
<dd><p>The mean of trainDist_avrg. Used for normalizing the DI</p></dd>

 <dt>trainDI</dt>
<dd><p>Dissimilarity Index of the training data</p></dd>

 <dt>threshold</dt>
<dd><p>The DI threshold used for inside/outside AOA</p></dd>

 <dt>trainLPD</dt>
<dd><p>LPD of the training data</p></dd>

 <dt>avrgLPD</dt>
<dd><p>Average LPD of the training data</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function is called within <code><a href="aoa.html">aoa</a></code> to estimate the DI and AOA of new data.
However, it may also be used on its own if only the DI of training data is of interest,
or to facilitate a parallelization of <code><a href="aoa.html">aoa</a></code> by avoiding a repeated calculation of the DI within the training data.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Meyer, H., Pebesma, E. (2021): Predicting into unknown space?
Estimating the area of applicability of spatial prediction models.
<a href="https://doi.org/10.1111/2041-210X.13650" class="external-link">doi:10.1111/2041-210X.13650</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="aoa.html">aoa</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Hanna Meyer, Marvin Ludwig, Fabian Schumacher</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HannaMeyer/CAST" class="external-link">CAST</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># prepare sample data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"splotdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">splotdata</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">splotdata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># train a model:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">splotdata</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                      <span class="va">splotdata</span><span class="op">$</span><span class="va">Species_richness</span>,</span></span>
<span class="r-in"><span>                      importance<span class="op">=</span><span class="cn">TRUE</span>, tuneLength<span class="op">=</span><span class="fl">1</span>, ntree <span class="op">=</span> <span class="fl">15</span>, method <span class="op">=</span> <span class="st">"rf"</span>,</span></span>
<span class="r-in"><span>                      trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>, number<span class="op">=</span><span class="fl">5</span>, savePredictions<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># variable importance is used for scaling predictors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">model</span>,scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate the DI of the trained model:</span></span></span>
<span class="r-in"><span><span class="va">DI</span> <span class="op">=</span> <span class="fu">trainDI</span><span class="op">(</span>model<span class="op">=</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">DI</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...or calculate the DI and LPD of the trained model:</span></span></span>
<span class="r-in"><span><span class="co"># DI = trainDI(model=model, LPD = TRUE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the DI can now be used to compute the AOA (here with LPD):</span></span></span>
<span class="r-in"><span><span class="va">studyArea</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors_chile.tif"</span>, package <span class="op">=</span> <span class="st">"CAST"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">AOA</span> <span class="op">=</span> <span class="fu"><a href="aoa.html">aoa</a></span><span class="op">(</span><span class="va">studyArea</span>, model <span class="op">=</span> <span class="va">model</span>, trainDI <span class="op">=</span> <span class="va">DI</span>, LPD <span class="op">=</span> <span class="cn">TRUE</span>, maxLPD <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">AOA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">LPD</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanna Meyer, Carles Milà, Marvin Ludwig, Jan Linnenbrink, Fabian Schumacher.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

