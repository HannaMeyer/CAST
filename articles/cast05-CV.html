<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CAST">
<title>5. Cross-validation methods in CAST • CAST</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Cross-validation methods in CAST">
<meta property="og:description" content="CAST">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CAST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cast01-CAST-intro.html">1. Introduction to CAST 1.0.0</a>
    <a class="dropdown-item" href="../articles/cast02-AOA-tutorial.html">2. Area of applicability of spatial prediction models</a>
    <a class="dropdown-item" href="../articles/cast03-parallel.html">3. Improve computation time of CAST methods</a>
    <a class="dropdown-item" href="../articles/cast04-plotgeodist.html">4. Visualization of nearest neighbor distance distributions</a>
    <a class="dropdown-item" href="../articles/cast05-CV.html">5. Cross-validation methods in CAST</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/HannaMeyer/CAST/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>5. Cross-validation methods in CAST</h1>
                        <h4 data-toc-skip class="author">Carles Milà and
Jan Linnenbrink</h4>
            
            <h4 data-toc-skip class="date">2024-03-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HannaMeyer/CAST/blob/HEAD/vignettes/cast05-CV.Rmd" class="external-link"><code>vignettes/cast05-CV.Rmd</code></a></small>
      <div class="d-none name"><code>cast05-CV.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/sf/" class="external-link">"sf"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/HannaMeyer/CAST" class="external-link">"CAST"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Cross-Validation (CV) is important for many tasks in a predictive
mapping workflow, including feature selection (check
<code><a href="../reference/ffs.html">CAST::ffs</a></code> and <code><a href="../reference/bss.html">CAST::bss</a></code>), hyperparameter
tuning, area of applicability estimation (check <code><a href="../reference/aoa.html">CAST::aoa</a></code>).
Moreover, in the unfortunate case where no independent samples are
available to estimate the performance of the final products, it can be
used as a last resort to obtain an estimate of the error.</p>
<p>The objective of this vignette is to show the CV options that CAST
offers. To do so, we will work with two datasets of annual average air
temperature and air pollution (PM<span class="math inline">\(_{2.5}\)</span>) in Spain, for which several
predictors including a elevation land cover, impervious surfaces, and
population and road density, remote sensing measurements of NDVI,
nighttime lights, and land surface temperature among others. For more
details, check our <a href="https://egusphere.copernicus.org/preprints/2024/egusphere-2024-138/" class="external-link">preprint</a>
where the dataset is described in more detail.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"https://github.com/carlesmila/RF-spatial-proxies/raw/main/data/temp/temp_train.gpkg"</span><span class="op">)</span></span>
<span><span class="va">pm25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"https://github.com/carlesmila/RF-spatial-proxies/raw/main/data/AP/PM25_train.gpkg"</span><span class="op">)</span></span>
<span><span class="va">spain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"https://github.com/carlesmila/RF-spatial-proxies/raw/main/data/boundaries/spain.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot them</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spain</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temperature</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdYlBu"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Average 2019 temperature (ºC)"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spain</span>, fill <span class="op">=</span> <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pm25</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">PM25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"cividis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Average 2019 PM2.5 (ug/m3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="cast05-CV_files/figure-html/read%20data-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Looking at the two maps we can see that while air temperature
stations are nicely distributed around the area of interest; however,
air pollution stations are concentrated in specific regions.</p>
</div>
<div class="section level2">
<h2 id="cross-validation-in-geographical-space">Cross-validation in geographical space<a class="anchor" aria-label="anchor" href="#cross-validation-in-geographical-space"></a>
</h2>
<div class="section level3">
<h3 id="evaluation-of-spatial-predictive-conditions">Evaluation of spatial predictive conditions<a class="anchor" aria-label="anchor" href="#evaluation-of-spatial-predictive-conditions"></a>
</h3>
<p>In CAST, we deal with data that are indexed in space, i.e. data that
present dependencies that do not comply with the assumptions of
independence of standard CV methods such as Leave-One-Out (LOO) CV or
k-fold CV. Several CV approaches have been proposed to deal with these
including blocking and buffering strategies that try to deal with the
dependency between the train and hold out data. However, in CAST, we
propose strategies that are prediction-oriented, i.e. CV methods that
aim to approximate the predictive conditions found when using a model
for a specific prediction task. And how we define these conditions?
There are several approaches: we could consider the geographical space
by focusing on the spatial locations of the samples and prediction
points. Another possibility is to consider the feature space, i.e. the
covariate values both in the train and prediction set. And there are yet
other possibilities, such as considering space-time.</p>
<p>For this section, let’s consider geographical space and show what we
mean by “predictive conditions” and also see what would happen if we
simply used 1) a LOO CV and 2) a random 5-fold CV in each of the two
cases. In CAST, this can be easily done by the
<code><a href="../reference/geodist.html">CAST::geodist</a></code> function, which computes the distribution of
nearest neighbour distances between 1) prediction and training points
(prediction-to-sample), 2) holdout points and training points during a
LOO CV (sample-to-sample), 3) hold out points and training points during
a given CV, in our case the 5-fold random CV (CV-distances).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random 5-fold CV</span></span>
<span><span class="va">fold5_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createFolds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span>, k<span class="op">=</span><span class="fl">5</span>, returnTrain<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">fold5_pm25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createFolds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pm25</span><span class="op">)</span>, k<span class="op">=</span><span class="fl">5</span>, returnTrain<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Explore geographic predictive conditions</span></span>
<span><span class="va">predcond_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span><span class="op">(</span><span class="va">temperature</span>, modeldomain <span class="op">=</span> <span class="va">spain</span>, cvfolds <span class="op">=</span> <span class="va">fold5_temp</span><span class="op">)</span></span>
<span><span class="va">predcond_pm25</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/geodist.html">geodist</a></span><span class="op">(</span><span class="va">pm25</span>, modeldomain <span class="op">=</span> <span class="va">spain</span>, cvfolds <span class="op">=</span> <span class="va">fold5_pm25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot density functions</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predcond_temp</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predcond_pm25</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">PM</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="cast05-CV_files/figure-html/geodist%20density-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We see that, for temperature, although the distribution of
geographical distances during CV vs. during prediction do not exactly
match, the overlap between the two is substantial. In the PM<span class="math inline">\(_{2.5}\)</span> case, however, the clustering of
the stations make prediction-to-sample distances to be much longer that
those found during CV.</p>
<p>Before we jump into the CV methods included in <code>CAST</code>, it
is worth to consider an alternative visualization of the distance
distribution using their Empirical Cumulative Density Functions (ECDF)
rather than their density functions, which express, for a given
distance, the proportion of observations that have a value equal or
lower to than distance. Working with ECDFs has the advantage of not
having to choose any additional parameter to estimate the density
function, and they are one of the building blocks of our proposed
methods.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot ECDF functions</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predcond_temp</span>, stat <span class="op">=</span> <span class="st">"ecdf"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Temperature"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predcond_pm25</span>, stat <span class="op">=</span> <span class="st">"ecdf"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">PM</span><span class="op">[</span><span class="fl">2.5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="cast05-CV_files/figure-html/geodist%20ecdf-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="spatial-nndm-loo-cv-for-small-datasets">Spatial NNDM LOO CV for small datasets<a class="anchor" aria-label="anchor" href="#spatial-nndm-loo-cv-for-small-datasets"></a>
</h3>
<p>The cross-validation methods included in <code>CAST</code> are named
Nearest Neighbour Distance Matching (NNDM) and their goal is precisely
to match the distance distributions during CV and prediction we just saw
in the last plots. To do so, these methods propose a CV configuration
such that the nearest neighbour distance distribution between hold out
and training points found during the CV matches as close as possible the
distribution of nearest neighbour distances during the prediction.</p>
<p>The first of the two NNDM methods is LOO NNDM. NNDM is a greedy,
iterative algorithm that starts with a standard LOO CV and compares the
ECDF during CV to that found during prediction. Briefly, when it finds
that the ECDF during the CV is greater than the ECDF during the
prediction, it removes points in the neighbourhood of the points being
validated until a match is achieved. In practice, NNDM is effective for
matching the ECDF when training data are clustered, while it generalizes
to a standard LOO CV when data are random or regular. All details on the
algorithm and a simulation study evaluating its performance can be found
in the article <a href="https://doi.org/10.5194/egusphere-2023-1308" class="external-link">here</a> and listed
at the end of the vignette.</p>
<p>Now, let’s run the NNDM LOO CV algorithm for both datasets and check
their output, first for temperature. Here, we use the polygon of Spain
as <code>modeldomain</code> from which 1,000 are regularly sampled as
prediction points. However, it would also, but it would also be possible
to pass to the function a set of prediction points previously defined
(check argument <code>predpoints</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_nndm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nndm.html">nndm</a></span><span class="op">(</span><span class="va">temperature</span>, modeldomain <span class="op">=</span> <span class="va">spain</span>, samplesize <span class="op">=</span> <span class="fl">1000</span>, phi <span class="op">=</span> <span class="st">"max"</span>, min_train <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">temp_nndm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## nndm object</span></span>
<span><span class="co">## Total number of points: 195</span></span>
<span><span class="co">## Mean number of training points: 193.91</span></span>
<span><span class="co">## Minimum number of training points: 191</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">temp_nndm</span>, type <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cast05-CV_files/figure-html/NNDM%20LOO%20temp-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Now, we do the same for air pollution</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm25_nndm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nndm.html">nndm</a></span><span class="op">(</span><span class="va">pm25</span>, modeldomain <span class="op">=</span> <span class="va">spain</span>, phi <span class="op">=</span> <span class="st">"max"</span>, min_train <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">pm25_nndm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## nndm object</span></span>
<span><span class="co">## Total number of points: 124</span></span>
<span><span class="co">## Mean number of training points: 118.74</span></span>
<span><span class="co">## Minimum number of training points: 105</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pm25_nndm</span>, type <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cast05-CV_files/figure-html/NNDM%20LOO%20pm25-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Now it’s time to fit the models and estimate their performance using
1) a standard LOO CV, and 2) NNDM LOO CV.</p>
</div>
<div class="section level3">
<h3 id="spatial-knndm-cv-for-medium-and-large-datasets">Spatial kNNDM CV for medium and large datasets<a class="anchor" aria-label="anchor" href="#spatial-knndm-cv-for-medium-and-large-datasets"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="cross-validation-in-feature-space">Cross-validation in feature space<a class="anchor" aria-label="anchor" href="#cross-validation-in-feature-space"></a>
</h2>
<p>Coming soon!</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>Linnenbrink, J., Milà, C., Ludwig, M., and Meyer, H.: kNNDM: k-fold
Nearest Neighbour Distance Matching Cross-Validation for map accuracy
estimation, EGUsphere [preprint], <a href="https://doi.org/10.5194/egusphere-2023-1308" class="external-link uri">https://doi.org/10.5194/egusphere-2023-1308</a>
</li>
<li>Milà, C., Mateu, J., Pebesma, E., Meyer, H. (2022): Nearest
Neighbour Distance Matching Leave-One-Out Cross-Validation for map
validation. Methods in Ecology and Evolution 00, 1– 13. <a href="https://doi.org/10.1111/2041-210X.13851" class="external-link uri">https://doi.org/10.1111/2041-210X.13851</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hanna Meyer, Carles Milà, Marvin Ludwig, Jan Linnenbrink, Fabian Schumacher.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
