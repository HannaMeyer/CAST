<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CAST">
<title>5. Cross-validation methods in CAST • CAST</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Cross-validation methods in CAST">
<meta property="og:description" content="CAST">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CAST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cast01-CAST-intro.html">1. Introduction to CAST 1.0.0</a>
    <a class="dropdown-item" href="../articles/cast02-AOA-tutorial.html">2. Area of applicability of spatial prediction models</a>
    <a class="dropdown-item" href="../articles/cast03-AOA-parallel.html">3. AOA in Parallel</a>
    <a class="dropdown-item" href="../articles/cast04-plotgeodist.html">4. Visualization of nearest neighbor distance distributions</a>
    <a class="dropdown-item" href="../articles/cast05-CV.html">5. Cross-validation methods in CAST</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/HannaMeyer/CAST/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>5. Cross-validation methods in CAST</h1>
                        <h4 data-toc-skip class="author">Carles
Milà</h4>
            
            <h4 data-toc-skip class="date">2024-03-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HannaMeyer/CAST/blob/HEAD/vignettes/cast05-CV.Rmd" class="external-link"><code>vignettes/cast05-CV.Rmd</code></a></small>
      <div class="d-none name"><code>cast05-CV.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-and-motivational-example">Introduction and motivational example<a class="anchor" aria-label="anchor" href="#introduction-and-motivational-example"></a>
</h2>
<p>Cross-Validation (CV) is important for many tasks in a predictive
mapping workflow, including feature selection (check
<code><a href="../reference/ffs.html">CAST::ffs</a></code> and <code><a href="../reference/bss.html">CAST::bss</a></code>), hyperparameter
tuning, area of applicability estimation (check <code><a href="../reference/aoa.html">CAST::aoa</a></code>).
Moreover, in the unfortunate case where no independent samples are
available to estimate the performance of the final products, it can be
used as a last resort to obtain an estimate of the map error.</p>
<p>In CAST, we deal with data that are indexed in space, i.e. data that
present dependencies that do not comply with the assumptions of
independence of standard CV methods such as Leave-One-Out (LOO) CV or
k-fold CV. Several CV approaches have been proposed to deal with these
including blocking and buffering strategies that try to deal with the
dependency between the train and hold out data. However, in CAST, we
propose strategies that are prediction-oriented, i.e. CV methods that
aim to approximate the predictive conditions found when using a model
for a specific prediction task. And how we define these conditions? In
the current state of CAST, we mainly focus on the geographical space by
comparing the distances between prediction and training locations.
However, future developments are planned so check the “current
developments” section below if interested!</p>
<p>For now, let’s consider geographical space and show what we mean by
this. First, we load two datasets that will nicely illustrate how our
proposed methods work. We will work with a dataset of annual average air
temperature and air pollution (PM2.5) in Spain,,for which several
predictors including a elevation land cover, impervious surfaces, and
population and road density, remote sensing measurements of NDVI,
nighttime lights, and land surface temperature among others. For more
details, check our <a href="https://egusphere.copernicus.org/preprints/2024/egusphere-2024-138/" class="external-link">preprint</a>
where the dataset is described in more detail.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/sf/" class="external-link">"sf"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read data</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"https://github.com/carlesmila/RF-spatial-proxies/raw/main/data/temp/tempdata.gpkg"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `tempdata' from data source </span></span>
<span><span class="co">##   `https://github.com/carlesmila/RF-spatial-proxies/raw/main/data/temp/tempdata.gpkg' </span></span>
<span><span class="co">##   using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 195 features and 2 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 36026.79 ymin: 3988818 xmax: 978160.6 ymax: 4858999</span></span>
<span><span class="co">## Projected CRS: ED50 / UTM zone 30N</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pm25 &lt;- st_read()</span></span>
<span><span class="va">temperature</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 195 features and 2 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 36026.79 ymin: 3988818 xmax: 978160.6 ymax: 4858999</span></span>
<span><span class="co">## Projected CRS: ED50 / UTM zone 30N</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##       ID     temp                     geom</span></span>
<span><span class="co">## 1  0002I 17.52610 POINT (825940.4 4541533)</span></span>
<span><span class="co">## 2  0016A 16.94795 POINT (849548.2 4563427)</span></span>
<span><span class="co">## 3   0076 17.49233 POINT (924683.3 4583884)</span></span>
<span><span class="co">## 4  0149X 15.30838 POINT (902776.4 4630234)</span></span>
<span><span class="co">## 5  0200E 16.56247 POINT (928394.5 4598097)</span></span>
<span><span class="co">## 6  0201D 17.22139 POINT (934920.7 4595391)</span></span>
<span><span class="co">## 7  0252D 17.53605 POINT (961955.5 4619036)</span></span>
<span><span class="co">## 8  0255B 15.04821 POINT (974578.1 4626926)</span></span>
<span><span class="co">## 9  0324A 12.80667 POINT (929203.7 4684325)</span></span>
<span><span class="co">## 10  0367 15.61917 POINT (978160.6 4656271)</span></span></code></pre>
<p>One way to quantify the predictive conditions in the geographic space
would be to compute the distribution of geographic nearest neighbour
distances between the prediction points and training points and compare
it to that found during the CV between the hold-out points and the
training data. In CAST, this is easily done by the
<code><a href="../reference/geodist.html">CAST::geodist</a></code> function, which also computes the
distribution of nearest neighbour distances of the training points by
default:</p>
<p>We see that, for the red samples, distances when using a random
k-fold CV are much shorter than those found when predicting for this
area. This is something that has been reported several times when using
clustered data and that could potentially lead to unwanted outputs such
as overoptimistic performance estimates (see Linnenbrink et al 2024 and
Milà et al 2022), or overfitting when used for feature selection (see
Meyer et al 2019). Ideally, we would like our two distributions to be as
similar as possible like in the case of the blue samples, and this is
when the Nearest Neighbour Distance Matching (NNDM) methods implemented
in <code>CAST</code> come in.</p>
</div>
<div class="section level2">
<h2 id="nndm-methods-implemented-in-cast">NNDM methods implemented in CAST<a class="anchor" aria-label="anchor" href="#nndm-methods-implemented-in-cast"></a>
</h2>
<div class="section level3">
<h3 id="nndm-loo-cv-for-small-datasets">NNDM LOO CV for small datasets<a class="anchor" aria-label="anchor" href="#nndm-loo-cv-for-small-datasets"></a>
</h3>
</div>
<div class="section level3">
<h3 id="knndm-cv-for-medium-and-large-datasets">kNNDM CV for medium and large datasets<a class="anchor" aria-label="anchor" href="#knndm-cv-for-medium-and-large-datasets"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="current-and-future-developments">Current and future developments<a class="anchor" aria-label="anchor" href="#current-and-future-developments"></a>
</h2>
<p>In the currently state of CRAN, we have an experimental version for
cross-validation in the feature space using <code>knndm</code>. Briefly,
we extend our ideas for geographical distances to feature distances
while taking into account their specific characteristics, such as
dealing with categorical features, and predictors, and potentially high
dimensional. Stay tuned for developments in this area, as well as others
we have plan to implement (we see you spatiotemporal modellers), coming
soon!</p>
</div>
<div class="section level2">
<h2 id="take-away-messages">Take-away messages<a class="anchor" aria-label="anchor" href="#take-away-messages"></a>
</h2>
<ul>
<li>CAST proposes two NNDM methods for cross-validation in the
geographical space that aim at reproducing the conditions found when
predicting in a defined area during CV.</li>
<li>Both LOO NNDM and kNNDM aim to match the CV ECDF to the
prediction-to-error ECDF.</li>
<li>NNDM LOO CV generally offers better matches but can only be used for
small sample sizes.</li>
<li>kNNDM CV offers k-fold alternative for medium and large datasets
that are commonly found.</li>
<li>Future work will extend the ideas of the geographical space to the
feature space and much more!</li>
</ul>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>Methods implemented in CAST: * Linnenbrink, J., Milà, C., Ludwig, M.,
and Meyer, H.: kNNDM: k-fold Nearest Neighbour Distance Matching
Cross-Validation for map accuracy estimation, EGUsphere [preprint], <a href="https://doi.org/10.5194/egusphere-2023-1308" class="external-link uri">https://doi.org/10.5194/egusphere-2023-1308</a> * Milà, C.,
Mateu, J., Pebesma, E., Meyer, H. (2022): Nearest Neighbour Distance
Matching Leave-One-Out Cross-Validation for map validation. Methods in
Ecology and Evolution 00, 1– 13. <a href="https://doi.org/10.1111/2041-210X.13851" class="external-link uri">https://doi.org/10.1111/2041-210X.13851</a></p>
<p>Other useful references: * Meyer, H., Reudenbach, C., Wöllauer, S.,
Nauss, T. (2019): Importance of spatial predictor variable selection in
machine learning applications - Moving from data reproduction to spatial
prediction. Ecological Modelling. 411, 108815. <a href="doi:10.1016/j.ecolmodel.2019.108815" class="uri">doi:10.1016/j.ecolmodel.2019.108815</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hanna Meyer, Carles Milà, Marvin Ludwig, Jan Linnenbrink, Fabian Schumacher.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
