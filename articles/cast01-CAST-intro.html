<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CAST">
<title>1. Introduction to CAST • CAST</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1. Introduction to CAST">
<meta property="og:description" content="CAST">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CAST</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cast01-CAST-intro.html">1. Introduction to CAST</a>
    <a class="dropdown-item" href="../articles/cast02-AOA-tutorial.html">2. Area of applicability of spatial prediction models</a>
    <a class="dropdown-item" href="../articles/cast03-AOA-parallel.html">3. AOA in Parallel</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/HannaMeyer/CAST/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="cast01-CAST-intro_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="cast01-CAST-intro_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="cast01-CAST-intro_files/leaflet-1.3.1/leaflet.js"></script><link href="cast01-CAST-intro_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="cast01-CAST-intro_files/proj4-2.6.2/proj4.min.js"></script><script src="cast01-CAST-intro_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="cast01-CAST-intro_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="cast01-CAST-intro_files/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="cast01-CAST-intro_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="cast01-CAST-intro_files/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="cast01-CAST-intro_files/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="cast01-CAST-intro_files/HomeButton-0.0.1/home-button.js"></script><script src="cast01-CAST-intro_files/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="cast01-CAST-intro_files/clipboard-0.0.1/setClipboardText.js"></script><link href="cast01-CAST-intro_files/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="cast01-CAST-intro_files/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>1. Introduction to CAST</h1>
                        <h4 data-toc-skip class="author">Hanna Meyer</h4>
            
            <h4 data-toc-skip class="date">2022-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HannaMeyer/CAST/blob/HEAD/vignettes/cast01-CAST-intro.Rmd" class="external-link"><code>vignettes/cast01-CAST-intro.Rmd</code></a></small>
      <div class="d-none name"><code>cast01-CAST-intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>One key task in environmental science is obtaining information of environmental variables in space or in space and time, usually based on limited field data. In that respect, machine learning algorithms have been proven to be an important tool to learn patterns in nonlinear and complex systems. However, standard machine learning applications are not suitable for spatio-temporal data, as they usually ignore the spatio-temporal dependencies in the data. This becomes problematic in (at least) two aspects of predictive modelling: Overfitting during model setup as well as objective error assessment (see <a href="https://www.sciencedirect.com/science/article/pii/S1364815217310976/" class="external-link">Meyer et al 2018</a>). To approach these problems, CAST supports the well-known caret package (<a href="http://topepo.github.io/caret/index.html" class="external-link">Kuhn 2018</a> to allow accounting for spatio-temporal dependencies in prediction tasks.</p>
<p>This tutorial shows how to set up a spatio-temporal prediction model that includes objective and reliable error estimation. It further shows how spatio-temporal overfitting can be detected by comparison between validation strategies. It will be shown that certain variables are responsible for the problem of overfitting due to spatio-temporal autocorrelation patterns. Therefore, this tutorial also shows how to automatically exclude variables that lead to overfitting with the aim to improve the spatio-temporal prediction model.</p>
<p>In order to follow this tutorial, I assume that the reader is familiar with the basics of predictive modelling nicely explained in <a href="https://doi.org/10.1007/978-1-4614-6849-3" class="external-link">Kuhn and Johnson 2013</a> as well as machine learning applications via the caret package.</p>
</div>
<div class="section level3">
<h3 id="how-to-start">How to start<a class="anchor" aria-label="anchor" href="#how-to-start"></a>
</h3>
<p>To work with the tutorial, first install the CAST package and load the library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("CAST")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HannaMeyer/CAST" class="external-link">CAST</a></span><span class="op">)</span></code></pre></div>
<p>If you need help, see</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">CAST</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-of-a-typical-spatio-temporal-prediction-task">Example of a typical spatio-temporal prediction task<a class="anchor" aria-label="anchor" href="#example-of-a-typical-spatio-temporal-prediction-task"></a>
</h2>
<p>The example prediction task for this tutorial is the following: We have a set of data loggers distributed over a farm, and we want to map soil moisture, based on a set of spatial and temporal predictor variables. We will use Random Forests as a machine learning algorithm in this tutorial.</p>
<div class="section level3">
<h3 id="description-of-the-example-dataset">Description of the example dataset<a class="anchor" aria-label="anchor" href="#description-of-the-example-dataset"></a>
</h3>
<p>To do so, we will work with the cookfarm dataset, described in e.g. <a href="https://www.sciencedirect.com/science/article/pii/S2211675315000251/" class="external-link">Gasch et al 2015</a> and available via the GSIF package (<a href="https://CRAN.R-project.org/package=GSIF/" class="external-link">Hengl 2017</a>). The dataset included in CAST is a re-structured dataset which was used for the analysis in <a href="https://www.sciencedirect.com/science/article/pii/S1364815217310976/" class="external-link">Meyer et al 2018</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Cookfarm.RData"</span>,package<span class="op">=</span><span class="st">"CAST"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        SOURCEID    VW  Easting Northing altitude      DEM      TWI     NDRE.M</span>
<span class="co">## 101689   CAF357 0.303 493828.1  5181021     -0.3 792.5756 3.791253 0.08161208</span>
<span class="co">## 213001   CAF357 0.328 493828.1  5181021     -0.6 792.5756 3.791253 0.08161208</span>
<span class="co">## 324313   CAF357 0.376 493828.1  5181021     -0.9 792.5756 3.791253 0.08161208</span>
<span class="co">## 435625   CAF357 0.350 493828.1  5181021     -1.2 792.5756 3.791253 0.08161208</span>
<span class="co">## 546937   CAF357 0.323 493828.1  5181021     -1.5 792.5756 3.791253 0.08161208</span>
<span class="co">## 101690   CAF357 0.297 493828.1  5181021     -0.3 792.5756 3.791253 0.08161208</span>
<span class="co">##          NDRE.Sd     Bt  BLD  PHI Crop       Date Precip_wrcc MaxT_wrcc</span>
<span class="co">## 101689 0.2805182 0.0000 1.22 5.84   SL 2010-01-01         5.8       2.8</span>
<span class="co">## 213001 0.2805182 0.0000 1.36 6.32   SL 2010-01-01         5.8       2.8</span>
<span class="co">## 324313 0.2805182 0.0000 1.48 6.52   SL 2010-01-01         5.8       2.8</span>
<span class="co">## 435625 0.2805182 0.0000 1.56 6.68   SL 2010-01-01         5.8       2.8</span>
<span class="co">## 546937 0.2805182 0.0106 1.60 6.72   SL 2010-01-01         5.8       2.8</span>
<span class="co">## 101690 0.2805182 0.0000 1.22 5.84   SL 2010-01-02         6.9       6.1</span>
<span class="co">##        MinT_wrcc Precip_cum  cday       cdayt</span>
<span class="co">## 101689      -3.3        5.8 14611 -0.05233596</span>
<span class="co">## 213001      -3.3        5.8 14611 -0.05233596</span>
<span class="co">## 324313      -3.3        5.8 14611 -0.05233596</span>
<span class="co">## 435625      -3.3        5.8 14611 -0.05233596</span>
<span class="co">## 546937      -3.3        5.8 14611 -0.05233596</span>
<span class="co">## 101690       0.6       12.7 14612 -0.03489950</span></code></pre>
<p>I want to point out on the following information of this dataset: The “SOURCEID” represents the ID for the data logger, “VW” is soil moisture which is our response variable, “Easting” and “Northing” are the coordinates of the data loggers, “altitude” indicates the depth of the soil in which VW was measured, and the remaining columns represent different potential predictor variables which are terrain related (e.g. “DEM”, “TWI”), vegetation indices (e.g. “NDRE”), soil properties (e.g. “BLD”) or climate-related predictors (e.g. “Precip_wrcc”). See <a href="https://www.sciencedirect.com/science/article/pii/S2211675315000251/" class="external-link">Gasch et al 2015</a> for further description on the dataset.</p>
<p>To get an impression on the spatial properties of the dataset, Let’s have a look on the spatial distribution of the data loggers on the cookfarm:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="va">data_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SOURCEID"</span>,<span class="st">"Easting"</span>,<span class="st">"Northing"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">data_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">data_sp</span>,coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Easting"</span>,<span class="st">"Northing"</span><span class="op">)</span>,crs<span class="op">=</span><span class="fl">26911</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_sp</span>,axes<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-4-1.png" width="847.68"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#...or plot the data with mapview (recommended!):</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapviewOptions.html" class="external-link">mapviewOptions</a></span><span class="op">(</span>basemaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Esri.WorldImagery"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">data_sp</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-c400c81dfbe39dd561cd" style="width:847.68px;height:432.632880098888px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-c400c81dfbe39dd561cd">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[46.7827094243563,46.7810474298964,46.7822118864268,46.7821244303069,46.7811164910382,46.7820664321459,46.7790114272669,46.7804214275861,46.7822564266935,46.7812619012655,46.7790214255424,46.7810074197706,46.7812714328778,46.778850429275,46.7795934242203,46.780086424431,46.7810134231558,46.7828197451873,46.7832814229957,46.7801924259707,46.7792694357272,46.7802194173457,46.7827394191791,46.7799914297166,46.7810474162986,46.7802254310122,46.7812464209744,46.778789419396,46.7796404207032,46.7802884364115,46.78063643451,46.782137425164,46.7797152349755,46.7786304230967,46.7800604210001,46.7833014196016,46.779825069268,46.7818761979397,46.7827234175135,46.779133430799,46.7788250349062,46.7786724247612],[-117.080856768067,-117.079555766169,-117.079303577447,-117.078431765116,-117.080439480586,-117.07759576426,-117.082631769182,-117.081252767948,-117.080103767131,-117.081245438073,-117.083467770174,-117.08457177188,-117.077936764391,-117.081795768259,-117.083634770489,-117.083102769978,-117.082899769976,-117.081652099219,-117.080991768365,-117.082266769066,-117.078287764286,-117.086446773861,-117.083364770951,-117.080594767091,-117.086243773781,-117.079758766149,-117.083788771071,-117.086679773725,-117.085306772385,-117.07707276314,-117.077684763941,-117.080939767972,-117.088074818179,-117.085007771853,-117.084774771898,-117.082663770312,-117.078020924073,-117.084358740855,-117.084200771818,-117.080795767158,-117.088468039045,-117.084171770819],6,null,"data_sp",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#B4DC3B","#00B488","#6FD15D","#82D455","#00B488","#93D74C","#34407D","#009297","#59CD65","#00BD7F","#3B3878","#00A98F","#00C179","#34407D","#005D8D","#008097","#00AE8C","#C4DE33","#E2E22B","#008097","#1A4F86","#007295","#A4DA44","#008698","#00A492","#008C98","#00B884","#491361","#00568A","#009896","#009E94","#3FCA6C","#006490","#471E67","#007996","#D3E02E","#006B93","#14C673","#93D74C","#2A4782","#403073","#44276D"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>101689&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF357&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>70025&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF217&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>199795&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF312&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>91146&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF314&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>67387&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF215&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>93803&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF316&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14354&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF033&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>51496&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF163&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>85873&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF310&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>75262&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF237&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>345640&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF031&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>62139&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF205&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>189255&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF245&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>462286&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF035&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27651&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF079&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>40916&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF133&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>64793&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF209&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>104474&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF377&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>109780&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF401&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>154881&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF135&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22348&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF067&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35613&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF125&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>99171&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF351&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>157537&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF139&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>282114&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF201&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>48880&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF141&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>72664&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF231&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1156&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF003&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25043&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF075&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>54226&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF173&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>168191&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF197&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>83306&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF308&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30440&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF095&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3948&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF007&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38442&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF129&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>107306&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF397&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33315&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF119&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>80983&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF275&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>96901&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF349&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>131390&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF061&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9500&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF019&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6850&emsp;<\/td><\/tr><tr><td>1<\/td><th>SOURCEID&emsp;<\/th><td>CAF009&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["CAF357","CAF217","CAF312","CAF314","CAF215","CAF316","CAF033","CAF163","CAF310","CAF237","CAF031","CAF205","CAF245","CAF035","CAF079","CAF133","CAF209","CAF377","CAF401","CAF135","CAF067","CAF125","CAF351","CAF139","CAF201","CAF141","CAF231","CAF003","CAF075","CAF173","CAF197","CAF308","CAF095","CAF007","CAF129","CAF397","CAF119","CAF275","CAF349","CAF061","CAF019","CAF009"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-117.088468039045,46.7786304230967,-117.07707276314,46.7833014196016,true,"data_sp","Zoom to data_sp","<strong> data_sp <\/strong>","bottomright"]},{"method":"addLayersControl","args":["Esri.WorldImagery","data_sp",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#491361","#471D66","#45256C","#412D71","#3D3576","#383C7B","#30437F","#264A83","#165187","#00578A","#005D8D","#006390","#006A92","#007094","#007696","#007D97","#008397","#008898","#008D98","#009397","#009896","#009E94","#00A392","#00A890","#00AC8D","#00B18A","#00B686","#00BA82","#00BE7D","#04C278","#1AC672","#3ECA6C","#56CD66","#6BD05F","#7CD358","#8CD650","#9BD848","#AADB41","#B9DD39","#C7DE32","#D4E02E","#E2E22B"],"labels":["CAF003","CAF007","CAF009","CAF019","CAF031","CAF033","CAF035","CAF061","CAF067","CAF075","CAF079","CAF095","CAF119","CAF125","CAF129","CAF133","CAF135","CAF139","CAF141","CAF163","CAF173","CAF197","CAF201","CAF205","CAF209","CAF215","CAF217","CAF231","CAF237","CAF245","CAF275","CAF308","CAF310","CAF312","CAF314","CAF316","CAF349","CAF351","CAF357","CAF377","CAF397","CAF401"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"data_sp","extra":null,"layerId":null,"className":"info legend","group":"data_sp"}]}],"limits":{"lat":[46.7786304230967,46.7833014196016],"lng":[-117.088468039045,-117.07707276314]},"fitBounds":[46.7786304230967,-117.088468039045,46.7833014196016,-117.07707276314,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><p>We see that the data are taken at 42 locations (SOURCEID) over the field. The loggers recorded data between 2007 and 2013 (the dataset here only contains the data from 2010 on). The data are given here on a daily basis.</p>
</div>
<div class="section level3">
<h3 id="data-subsetting">Data subsetting<a class="anchor" aria-label="anchor" href="#data-subsetting"></a>
</h3>
<p>To reduce the data to an amount that can be handeld in a tutorial, let’s restrict the data to the depth of -0.3 and to two weeks of the year 2012. After subsetting let’s have an overview on the soil moisture time series measured by teh data loggers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="va">trainDat</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">altitude</span><span class="op">==</span><span class="op">-</span><span class="fl">0.3</span><span class="op">&amp;</span>
                   <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op">==</span><span class="fl">2012</span><span class="op">&amp;</span>
                   <span class="fu"><a href="https://lubridate.tidyverse.org/reference/week.html" class="external-link">week</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,<span class="op">]</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trainDat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Date</span>, y<span class="op">=</span><span class="va">VW</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">SOURCEID</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-6-1.png" width="847.68"></p>
<p>What we can see is that (as expected) each logger location has a unique time series of soil moisture.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-training-and-prediction">Model training and prediction<a class="anchor" aria-label="anchor" href="#model-training-and-prediction"></a>
</h2>
<p>In the following we will use this subset of the cookfarm data as an example to spatially predict soil moisture with (and without) consideration of the spatio-temporal dependencies. To start with, lets use this dataset to create a “default” Random Forest model that predicts soil moisture based on a hand full of predictor variables. To keep computation time at a minimum, we don’t include hyperparameter tuning (hence mtry was set to 2) which is reasonable as Random Forests are comparably insensitive to tuning.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span>
<span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DEM"</span>,<span class="st">"TWI"</span>,<span class="st">"Precip_cum"</span>,<span class="st">"cday"</span>,
                <span class="st">"MaxT_wrcc"</span>,<span class="st">"Precip_wrcc"</span>,<span class="st">"BLD"</span>,
                <span class="st">"Northing"</span>,<span class="st">"Easting"</span>,<span class="st">"NDRE.M"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">[</span>,<span class="va">predictors</span><span class="op">]</span>,<span class="va">trainDat</span><span class="op">$</span><span class="va">VW</span>,
               method<span class="op">=</span><span class="st">"rf"</span>,tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"mtry"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
               importance<span class="op">=</span><span class="cn">TRUE</span>,ntree<span class="op">=</span><span class="fl">50</span>,
               trControl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,number<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Based on the trained model we can make spatial predictions of soil moisture. To do this we load a RasterStack that contains spatial data of all predictor variables for the 25th of March 2012. We then apply the trained model on this data set.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span>
<span class="va">predictors_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"predictors_2012-03-25.grd"</span>,package<span class="op">=</span><span class="st">"CAST"</span><span class="op">)</span><span class="op">)</span>
<span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">predictors_sp</span>,<span class="va">model</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-8-1.png" width="847.68"></p>
<p>The result is a spatially comprehensive map of soil moisture for this day. We see that simply creating a map using machine learning and caret is an easy task, however accurately measuring its performance is less simple. Though the map looks good on a first sight we now have to follow the question of how accurate this map is, hence we need to ask how well the model is able to map soil moisture.</p>
<p>From a visible inspection it is noticeable that the model produces a strange linear features at the eastern side of the farm which looks suspicious. But let’s come back to this later and first focus on a statistical validation of the model.</p>
</div>
<div class="section level2">
<h2 id="cross-validation-strategies-for-spatio-temporal-data">Cross validation strategies for spatio-temporal data<a class="anchor" aria-label="anchor" href="#cross-validation-strategies-for-spatio-temporal-data"></a>
</h2>
<p>Amongst validation strategies, k-fold cross validation (CV) is popular to estimate the performance of the model in view to data that have not been used for model training. During CV, models are repeatedly trained (k models) and in each model run, the data of one fold are put to the side and are not used for model training but for model validation. In this way, the performance of the model can be estimated using data that have not been included in the model training.</p>
<div class="section level3">
<h3 id="the-standard-approach-random-k-fold-cv">The Standard approach: Random k-fold CV<a class="anchor" aria-label="anchor" href="#the-standard-approach-random-k-fold-cv"></a>
</h3>
<p>In the example above we used a random k-fold CV that we defined in caret’s trainControl argument. More specifically, we used a random 5-fold CV. Hence, the data points in our dataset were RANDOMLY split into 5 folds. To assess the performance of the model let’s have a look on the output of the Random CV:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span></code></pre></div>
<pre><code><span class="co">## Random Forest </span>
<span class="co">## </span>
<span class="co">## 654 samples</span>
<span class="co">##  10 predictor</span>
<span class="co">## </span>
<span class="co">## No pre-processing</span>
<span class="co">## Resampling: Cross-Validated (3 fold) </span>
<span class="co">## Summary of sample sizes: 436, 437, 435 </span>
<span class="co">## Resampling results:</span>
<span class="co">## </span>
<span class="co">##   RMSE        Rsquared   MAE       </span>
<span class="co">##   0.02188303  0.9044144  0.01273172</span>
<span class="co">## </span>
<span class="co">## Tuning parameter 'mtry' was held constant at a value of 2</span></code></pre>
<p>We see that soil moisture could be modelled with an R² of 0.90 which indicates a nearly perfect fit of the data. Sounds good, but unfortunately, the random k fold CV does not give us a good indication for the model performance. Random k-fold CV means that each of the five folds (with the highest certainty) contains data points from each data logger. Therefore, a random CV cannot indicate the ability of the model to make predictions beyond the location of the training data (i.e. to map soil moisture). Since our aim is to map soil moisture, we rather need to perform a target-oriented validation which validates the model in view to spatial mapping.</p>
</div>
<div class="section level3">
<h3 id="target-oriented-validation">Target-oriented validation<a class="anchor" aria-label="anchor" href="#target-oriented-validation"></a>
</h3>
<p>We are not interested in the model performance in view to random subsets of our data loggers, but we need to know how well the model is able to make predictions for areas without data loggers. To find this out, we need to repeatedly leave the complete time series of one or more data loggers out and use them as test data during CV.</p>
<p>To do this we first need to create meaningful folds rather than random folds. CAST’s function “CreateSpaceTimeFolds” is designed to provide index arguments used by caret’s trainControl. The index defines which data points are used for model training during each model run and reversely defines which data points are held back. Hence, using the index argument we can account for the dependencies in the data by leaving the complete data from one or more data loggers out (LLO CV), from one or more time steps out (LTO CV) or from data loggers and time steps out (LLTO CV). In this example we’re focusing on LLO CV, therefore we use the column “SOURCEID” to define the location of a data logger and split the data into folds using this information. Analog to the random CV we split the data into five folds, hence five model runs are performed each leaving one fifth of all data loggers out for validation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateSpacetimeFolds.html">CreateSpacetimeFolds</a></span><span class="op">(</span><span class="va">trainDat</span>,spacevar <span class="op">=</span> <span class="st">"SOURCEID"</span>,
                                k<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">model_LLO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">[</span>,<span class="va">predictors</span><span class="op">]</span>,<span class="va">trainDat</span><span class="op">$</span><span class="va">VW</span>,
                   method<span class="op">=</span><span class="st">"rf"</span>,tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"mtry"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span>, importance<span class="op">=</span><span class="cn">TRUE</span>,
                   trControl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,
                                          index <span class="op">=</span> <span class="va">indices</span><span class="op">$</span><span class="va">index</span><span class="op">)</span><span class="op">)</span>
<span class="va">model_LLO</span></code></pre></div>
<pre><code><span class="co">## Random Forest </span>
<span class="co">## </span>
<span class="co">## 654 samples</span>
<span class="co">##  10 predictor</span>
<span class="co">## </span>
<span class="co">## No pre-processing</span>
<span class="co">## Resampling: Cross-Validated (10 fold) </span>
<span class="co">## Summary of sample sizes: 433, 430, 445 </span>
<span class="co">## Resampling results:</span>
<span class="co">## </span>
<span class="co">##   RMSE        Rsquared   MAE       </span>
<span class="co">##   0.07645742  0.1616273  0.05994028</span>
<span class="co">## </span>
<span class="co">## Tuning parameter 'mtry' was held constant at a value of 2</span></code></pre>
<p>By inspecting the output of the model, we see that in view to new locations, the R² is only 0.16 so the performance is much lower than expected from the random CV (R² = 0.90). Apparently, there is considerable overfitting in the model, causing a good random performance but a poor performance in view to new locations. This might partly be attributed to the choice of variables where we must suspect that certain variables are misinterpreted by the model (see <a href="https://www.sciencedirect.com/science/article/pii/S1364815217310976/" class="external-link">Meyer et al 2018</a>).</p>
<p>Let’s have a look at the variable importance ranking of Random Forest and see if we find something suspicious:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">model_LLO</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-11-1.png" width="847.68"></p>
<p>The importance ranking indicates that amongst others, “Easting” is an important variable. This fits to the observation of an inappropriate linear features in the predicted map. Apparently the model assigns a high importance to this variable which causes a high random CV performance. But at the same time the model fails in the prediction on new locations because the variable is unsuitable for predictions beyond the locations of the data loggers used for model training.</p>
<p>Assuming that certain variables are misinterpreted by the algorithm we should be able to produce a higher LLO performance when such variables are removed. Let’s see if this is true…</p>
</div>
</div>
<div class="section level2">
<h2 id="removing-variables-that-cause-overfitting">Removing variables that cause overfitting<a class="anchor" aria-label="anchor" href="#removing-variables-that-cause-overfitting"></a>
</h2>
<p>CAST’s forward feature selection (ffs) selects variables that make sense in view to the selected CV method and excludes those which are counterproductive in view to the selected CV method. When we use LLO as CV method, ffs selects variables that lead in combination to the highest LLO performance (i.e. the best spatial model). All variables that have no spatial meaning or are even counterproductive won’t improve or even reduce the LLO performance and are therefore excluded from the model by the ffs.</p>
<p>ffs is doing this job by first training models using all possible pairs of two predictor variables. The best model of these initial models is kept. On the basis of this best model the predictor variables are iteratively increased and each of the remaining variables is tested for its improvement of the currently best model. The process stops if none of the remaining variables increases the model performance when added to the current best model.</p>
<p>So let’s run the ffs on our case study using R² as a metric to select the optimal variables. This process will take 1-2 minutes…</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">ffsmodel_LLO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffs.html">ffs</a></span><span class="op">(</span><span class="va">trainDat</span><span class="op">[</span>,<span class="va">predictors</span><span class="op">]</span>,<span class="va">trainDat</span><span class="op">$</span><span class="va">VW</span>,metric<span class="op">=</span><span class="st">"Rsquared"</span>,
                    method<span class="op">=</span><span class="st">"rf"</span>, tuneGrid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"mtry"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
                    verbose<span class="op">=</span><span class="cn">FALSE</span>,ntree<span class="op">=</span><span class="fl">50</span>,
                    trControl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,
                                           index <span class="op">=</span> <span class="va">indices</span><span class="op">$</span><span class="va">index</span><span class="op">)</span><span class="op">)</span>
<span class="va">ffsmodel_LLO</span></code></pre></div>
<pre><code><span class="co">## Random Forest </span>
<span class="co">## </span>
<span class="co">## 654 samples</span>
<span class="co">##   3 predictor</span>
<span class="co">## </span>
<span class="co">## No pre-processing</span>
<span class="co">## Resampling: Cross-Validated (10 fold) </span>
<span class="co">## Summary of sample sizes: 433, 430, 445 </span>
<span class="co">## Resampling results:</span>
<span class="co">## </span>
<span class="co">##   RMSE       Rsquared   MAE      </span>
<span class="co">##   0.1013101  0.2833983  0.0767997</span>
<span class="co">## </span>
<span class="co">## Tuning parameter 'mtry' was held constant at a value of 2</span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ffsmodel_LLO</span><span class="op">$</span><span class="va">selectedvars</span></code></pre></div>
<pre><code><span class="co">## [1] "DEM"      "NDRE.M"   "Northing"</span></code></pre>
<p>Using the ffs with LLO CV, the R² could be increased from 0.16 to 0.28. The variables that are used for this model are “DEM”,“NDRE.M” and “Northing”. All others are removed because they have (at least in this small example) no spatial meaning or are even counterproductive.</p>
<p>Using the plot<span class="math inline">\(\_\)</span>ffs function we can visualize how the performance of the model changed depending on the variables being used:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_ffs.html">plot_ffs</a></span><span class="op">(</span><span class="va">ffsmodel_LLO</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-13-1.png" width="847.68"></p>
<p>See that the best model using two variables led to an R² of slightly above 0.2. Using the third variable could slightly increase the R². Any further variable could not improve the LLO performance. Note that the R² features a high standard deviation regardless of the variables being used. This is due to the small dataset that was used which cannot lead to robust results.</p>
<p>What effect does the new model has on the spatial representation of soil moisture?</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prediction_ffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">predictors_sp</span>,<span class="va">ffsmodel_LLO</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">prediction_ffs</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-14-1.png" width="847.68"></p>
<p>We see that the variable selection does not only have an effect on the statistical performance but also the predicted spatial patterns change considerably. It is of note that the linear feature is not any more in the resulting soil moisture map most likely because “Easting” was removed from the set of predictor variables by ffs.</p>
</div>
<div class="section level2">
<h2 id="area-of-applicability">Area of Applicability<a class="anchor" aria-label="anchor" href="#area-of-applicability"></a>
</h2>
<p>Still it is required to analyse if the model can be applied to the entire study area of if there are lcoations that are very different in their predictor properties to what the model has learned from. See more details in the vignette on the Area of applicability and <a href="https://arxiv.org/abs/2005.07939" class="external-link">Meyer and Pebesma 2020</a>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://latticeextra.r-forge.r-project.org/" class="external-link">latticeExtra</a></span><span class="op">)</span>

<span class="co">### AOA for which the spatial CV error applies:</span>
<span class="va">AOA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aoa.html">aoa</a></span><span class="op">(</span><span class="va">predictors_sp</span>,<span class="va">ffsmodel_LLO</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">prediction_ffs</span>,main<span class="op">=</span><span class="st">"prediction for the AOA \n(spatial CV error applied)"</span><span class="op">)</span><span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">AOA</span><span class="op">$</span><span class="va">AOA</span>,col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-15-1.png" width="847.68"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### AOA for which the random CV error applies:</span>
<span class="va">AOA_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aoa.html">aoa</a></span><span class="op">(</span><span class="va">predictors_sp</span>,<span class="va">model</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">prediction</span>,main<span class="op">=</span><span class="st">"prediction for the AOA \n(random CV error applied)"</span><span class="op">)</span><span class="op">+</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">AOA_random</span><span class="op">$</span><span class="va">AOA</span>,col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cast01-CAST-intro_files/figure-html/unnamed-chunk-15-2.png" width="847.68"></p>
<p>The figure shows in grey areas that are outside the area of applicability, hence predictions should not be considered for these locations.</p>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>To conclude, the tutorial has shown how CAST can be used to facilitate target-oriented CV on spatial and spatio-temporal data which is crucial to obtain meaningful validation results. Using the ffs in conjunction with target-oriented validation, variables can be excluded that are counterproductive in view to the target-orineted performance due to misinterpretations by the algorithm. ffs therefore helps to select the ideal set of predictor variables for spatio-temporal prediction tasks and gives objective error estimates.</p>
</div>
<div class="section level2">
<h2 id="final-notes">Final notes<a class="anchor" aria-label="anchor" href="#final-notes"></a>
</h2>
<p>The intention of this tutorial is to describe the motivation that led to the development of CAST as well as its functionality. Priority is not on modelling soil moisture of the cookfarm in the best possible way but to provide an example for the motivation and functionality of CAST that can run within a few minutes. Hence, only a very small subset of the entire cookfarm dataset was used. Keep in mind that due to the small subset the example is not robust and quite different results might be obtained depending on small changes in the settings.</p>
<p>The intention of showing the motivation of CAST is also the reason why the coordinates are used here as predictor variables. Though coordinates are used as predictors in quite some scientific studies they rather provide here an extreme example of how misleading variables can lead to overfitting.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li><p>Meyer, H., Pebesma, E.: Predicting into unknown space? Estimating the area of applicability of spatial prediction models. [<a href="https://arxiv.org/abs/2005.07939" class="external-link uri">https://arxiv.org/abs/2005.07939</a>]</p></li>
<li><p>Meyer H, Reudenbach C, Wöllauer S,Nauss T (2019) Importance of spatial predictor variable selection in machine learning applications–Moving from data reproduction to spatial prediction. Ecological Modelling 411: 108815 [<a href="https://doi.org/10.1016/j.ecolmodel.2019.108815" class="external-link uri">https://doi.org/10.1016/j.ecolmodel.2019.108815</a>]</p></li>
<li><p>Meyer H, Reudenbach C, Hengl T, Katurij M, Nauss T (2018) Improving performance of spatio-temporal machine learning models using forward feature selection and target-oriented validation. Environmental Modelling &amp; Software 101: 1–9 [<a href="https://doi.org/10.1016/j.envsoft.2017.12.001" class="external-link uri">https://doi.org/10.1016/j.envsoft.2017.12.001</a>]</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hanna Meyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
